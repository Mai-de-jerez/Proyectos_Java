package modelo;

import java.util.ArrayList;
import java.util.Scanner;

public class Flota {
	
	// atributo privado
	
	private ArrayList<Nave> naves;
	
	
	// constructor
	
	public Flota() {
		
		naves = new ArrayList<Nave>();
		
	}
	
	// Métodos
	
	/**
	 * Agrega una nave al arraylist de naves con add()
	 * @param nave
	 */
	public void agregarNave(Nave nave) {
		
		this.naves.add(nave); 
	}
	
	
	/**
	 * Pide por consola con Scanner el nombre, la faccion, el numero de misiles y si la nave necesita reparación
	 * y lo almacena en variables, luego usa esas variables para crear un nuevo objeto nave de la clase Nave()
	 * posteriormente agrega dicha nave a la lista de la flota con el método agregarNave()
	 * @param sc requiere un objeto scanner como parametro
	 */
	public void crearNaveDesdeTeclado(Scanner sc) {
		
		System.out.println("\n--- NUEVA NAVE ---");
		
		Nave nave = new Nave(); 
		
		System.out.println("Dime el nombre: ");
		nave.setNombre(sc.nextLine());
		
		Faccion faccion = null;     
	    while (faccion == null) {        
	        System.out.println("Dime la facción (Tierra, Marte o Cinturon): ");
	       
	        String entrada = sc.nextLine().trim().toUpperCase();
	        
	        // Compruebo la cadena manualmente
	        if (entrada.equals("TIERRA")) {
	            faccion = Faccion.TIERRA;
	        } else if (entrada.equals("MARTE")) {
	            faccion = Faccion.MARTE;
	        } else if (entrada.equals("CINTURON")) {
	            faccion = Faccion.CINTURON;
	        } else {
	            // Si no coincide lanzo error y vuelvo a pedir
	            System.err.println("¡ERROR! Facción '" + entrada + "' no válida. Debe ser Tierra, Marte o Cinturon. Inténtalo de nuevo.");
	        }
	    }
	   
	    nave.setFaccion(faccion);
		
			
		System.out.println("Dime el número de misiles: ");
		nave.setMisiles(sc.nextInt());
		sc.nextLine();
		
		System.out.println("¿Necesita reparación (S/N)?: ");
		char decision = sc.nextLine().toUpperCase().charAt(0);

		if (decision == 'S') {
		    nave.setNecesitaReparacion(true);
		} else {
		    nave.setNecesitaReparacion(false);
		}		
		
		this.agregarNave(nave);
		
		System.out.println("\n¡Nave " + nave.getNombre() + " creada y añadida a la flota!");
		
	}
		
	/**
	 * Con el método size() mide el tamaño de la lista naves
	 * @return tamaño de la lista
	 */
	public int getNumeroNaves() {
	    return this.naves.size(); 
	}
	
	/*
	 * Recorre con un bucle foreach la lista naves y las imprime con toString()
	 */
	public void listarTodas() {
		
		for (Nave nave : naves) {
			
			System.out.println(nave.toString());
			
		}
	}
	
	
	/*
	 * Recorre la lista naves e imprime solo aquellas que necesitan reparacion
	 * comprobando con un if si el metodo isNecesitaReparacion() es true
	 */
	public void listarNavesParaReparar() {
		
		for (Nave nave : naves) {
			
			if (nave.isNecesitaReparacion()) {
				
				System.out.println(nave.toString());
			
			}						
		}		
	}
	
	/**
	 * Recorre la lista naves y obtiene el número de misiles de cada nave y los va sumando
	 * a una variable totalMisiles
	 * @return numero total de misiles de todas las naves
	 */
	public int getTotalMisiles() {
		
		int totalMisiles = 0;
		
		for (Nave nave : naves) {
			
			totalMisiles += nave.getMisiles();						
		}	
		
		return totalMisiles;
	}
	
	
	public void listarPorFaccion(String faccion) {
	    
	    String entradaLimpia = faccion.trim().toUpperCase();
	    
	    Faccion faccionBuscada = null;
	
	    if (entradaLimpia.equals("TIERRA")) {
	        faccionBuscada = Faccion.TIERRA;
	    } else if (entradaLimpia.equals("MARTE")) {
	        faccionBuscada = Faccion.MARTE;
	    } else if (entradaLimpia.equals("CINTURON")) {
	        faccionBuscada = Faccion.CINTURON;
	    } 
	  
	    if (faccionBuscada == null) {
	  
	        System.out.println("\nNo se encontraron naves para la facción '" + faccion + 
	                           "'. (Verifique que introdujo Tierra, Marte o Cinturon correctamente).");
	        return; 
	    }

	    System.out.println("\n--- NAVES DE LA FACCIÓN: ---");
	    boolean encontradas = false;
	    
	    for (Nave nave : naves) {

	        if (nave.getFaccion() == faccionBuscada) {
	            
	            System.out.println(nave.toString());
	            encontradas = true;
	        }
	    }

	    if (!encontradas) {
	        System.out.println("No se encontraron naves para la facción " + faccionBuscada.getNombreVisible() + ".");
	    }
	
	}
	
	
	
}
